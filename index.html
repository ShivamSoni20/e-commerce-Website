<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>MyShop - Modern E-commerce</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      --secondary-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      --success-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
      --dark-bg: #1a1a2e;
      --card-bg: #ffffff;
    }
    
    body {
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      min-height: 100vh;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    
    .navbar {
      background: var(--primary-gradient) !important;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
      backdrop-filter: blur(10px);
    }
    
    .navbar-brand {
      font-size: 1.8rem;
      font-weight: bold;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
    }
    
    .hero-section {
      background: var(--primary-gradient);
      color: white;
      padding: 60px 0;
      margin-bottom: 40px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    }
    
    .hero-section h1 {
      font-size: 3rem;
      font-weight: bold;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
      animation: fadeInDown 1s;
    }
    
    .search-bar {
      max-width: 600px;
      margin: 20px auto;
      position: relative;
    }
    
    .search-bar input {
      border-radius: 50px;
      padding: 15px 25px;
      border: none;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    
    .search-bar i {
      position: absolute;
      right: 25px;
      top: 50%;
      transform: translateY(-50%);
      color: #667eea;
    }
    
    .category-pills {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      justify-content: center;
      margin: 20px 0;
    }
    
    .category-pill {
      padding: 10px 25px;
      border-radius: 50px;
      border: 2px solid white;
      background: rgba(255,255,255,0.2);
      color: white;
      cursor: pointer;
      transition: all 0.3s;
      backdrop-filter: blur(10px);
    }
    
    .category-pill:hover, .category-pill.active {
      background: white;
      color: #667eea;
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }
    
    .card {
      border: none;
      border-radius: 20px;
      overflow: hidden;
      transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      box-shadow: 0 5px 20px rgba(0,0,0,0.1);
      background: var(--card-bg);
      animation: fadeInUp 0.6s;
    }
    
    .card:hover {
      transform: translateY(-10px) scale(1.02);
      box-shadow: 0 15px 40px rgba(0,0,0,0.2);
    }
    
    .card-img-top {
      height: 250px;
      object-fit: cover;
      transition: transform 0.4s;
    }
    
    .card:hover .card-img-top {
      transform: scale(1.1);
    }
    
    .card-body {
      padding: 1.5rem;
    }
    
    .star {
      color: #ffd700;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
    }
    
    .price-tag {
      font-size: 1.5rem;
      font-weight: bold;
      background: var(--success-gradient);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    .btn-primary {
      background: var(--primary-gradient);
      border: none;
      border-radius: 50px;
      padding: 10px 25px;
      font-weight: 600;
      transition: all 0.3s;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
    }
    
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
    }
    
    .btn-outline-secondary {
      border-radius: 50px;
      padding: 10px 25px;
      font-weight: 600;
      transition: all 0.3s;
    }
    
    .btn-outline-light {
      border-radius: 50px;
      padding: 10px 25px;
      font-weight: 600;
      transition: all 0.3s;
    }
    
    .btn-outline-light:hover {
      transform: scale(1.05);
    }
    
    .cart-badge {
      animation: pulse 2s infinite;
    }
    
    .modal-content {
      border-radius: 20px;
      border: none;
      overflow: hidden;
    }
    
    .modal-header {
      background: var(--primary-gradient);
      color: white;
      border: none;
    }
    
    .cart-item {
      border-radius: 15px;
      margin-bottom: 10px;
      transition: all 0.3s;
      border: 2px solid #f0f0f0 !important;
    }
    
    .cart-item:hover {
      transform: translateX(5px);
      border-color: #667eea !important;
    }
    
    .quantity-controls {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .quantity-btn {
      width: 30px;
      height: 30px;
      border-radius: 50%;
      border: none;
      background: var(--primary-gradient);
      color: white;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .quantity-btn:hover {
      transform: scale(1.1);
    }
    
    .remove-btn {
      background: var(--secondary-gradient);
      border: none;
      border-radius: 50px;
      padding: 5px 15px;
      color: white;
      cursor: pointer;
      transition: all 0.3s;
    }
    
    .remove-btn:hover {
      transform: scale(1.05);
    }
    
    .checkout-btn {
      background: var(--success-gradient);
      border: none;
      border-radius: 50px;
      padding: 15px 40px;
      color: white;
      font-weight: bold;
      font-size: 1.2rem;
      cursor: pointer;
      transition: all 0.3s;
      box-shadow: 0 5px 20px rgba(0,0,0,0.2);
    }
    
    .checkout-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 25px rgba(0,0,0,0.3);
    }
    
    .empty-cart {
      text-align: center;
      padding: 40px;
      color: #999;
    }
    
    .empty-cart i {
      font-size: 4rem;
      margin-bottom: 20px;
    }
    
    .product-badge {
      position: absolute;
      top: 15px;
      right: 15px;
      background: var(--secondary-gradient);
      color: white;
      padding: 5px 15px;
      border-radius: 50px;
      font-size: 0.8rem;
      font-weight: bold;
      z-index: 10;
    }
    
    @keyframes fadeInDown {
      from {
        opacity: 0;
        transform: translateY(-20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    @keyframes pulse {
      0%, 100% {
        transform: scale(1);
      }
      50% {
        transform: scale(1.1);
      }
    }
    
    .filter-section {
      background: white;
      padding: 20px;
      border-radius: 15px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
      margin-bottom: 30px;
    }
    
    .price-range {
      width: 100%;
    }
    
    @media (max-width: 768px) {
      .hero-section h1 {
        font-size: 2rem;
      }
      
      .card-img-top {
        height: 200px;
      }
      
      .category-pills {
        gap: 5px;
      }
      
      .category-pill {
        padding: 8px 15px;
        font-size: 0.9rem;
      }
    }
    
    /* Footer Styles */
    .footer {
      background: var(--primary-gradient);
      color: white;
      padding: 60px 0 20px;
      margin-top: 80px;
      box-shadow: 0 -5px 20px rgba(0,0,0,0.1);
    }
    
    .footer h5 {
      font-weight: bold;
      margin-bottom: 20px;
      font-size: 1.3rem;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
    }
    
    .footer-links {
      list-style: none;
      padding: 0;
    }
    
    .footer-links li {
      margin-bottom: 12px;
    }
    
    .footer-links a {
      color: rgba(255,255,255,0.9);
      text-decoration: none;
      transition: all 0.3s;
      display: inline-block;
    }
    
    .footer-links a:hover {
      color: white;
      transform: translateX(5px);
      text-shadow: 0 0 10px rgba(255,255,255,0.5);
    }
    
    .footer-links i {
      margin-right: 10px;
      width: 20px;
    }
    
    .social-icons {
      display: flex;
      gap: 15px;
      margin-top: 20px;
    }
    
    .social-icon {
      width: 45px;
      height: 45px;
      border-radius: 50%;
      background: rgba(255,255,255,0.2);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      text-decoration: none;
      transition: all 0.3s;
      backdrop-filter: blur(10px);
    }
    
    .social-icon:hover {
      background: white;
      color: #667eea;
      transform: translateY(-5px) rotate(360deg);
      box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    }
    
    .contact-info {
      list-style: none;
      padding: 0;
    }
    
    .contact-info li {
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .contact-info i {
      width: 25px;
      height: 25px;
      background: rgba(255,255,255,0.2);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.9rem;
    }
    
    .newsletter-form {
      display: flex;
      gap: 10px;
      margin-top: 20px;
    }
    
    .newsletter-form input {
      flex: 1;
      padding: 12px 20px;
      border: none;
      border-radius: 50px;
      outline: none;
    }
    
    .newsletter-form button {
      padding: 12px 30px;
      border: none;
      border-radius: 50px;
      background: white;
      color: #667eea;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s;
    }
    
    .newsletter-form button:hover {
      transform: scale(1.05);
      box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    }
    
    .footer-bottom {
      border-top: 1px solid rgba(255,255,255,0.2);
      margin-top: 40px;
      padding-top: 20px;
      text-align: center;
      color: rgba(255,255,255,0.8);
    }
    
    @media (max-width: 768px) {
      .footer {
        padding: 40px 0 20px;
      }
      
      .newsletter-form {
        flex-direction: column;
      }
      
      .newsletter-form button {
        width: 100%;
      }
    }
    
    /* Auth Modal Styles */
    .auth-modal .modal-content {
      border-radius: 20px;
      overflow: hidden;
    }
    
    .auth-tabs {
      display: flex;
      border-bottom: 2px solid #f0f0f0;
      margin-bottom: 20px;
    }
    
    .auth-tab {
      flex: 1;
      padding: 15px;
      text-align: center;
      cursor: pointer;
      background: transparent;
      border: none;
      font-weight: 600;
      color: #666;
      transition: all 0.3s;
    }
    
    .auth-tab.active {
      color: #667eea;
      border-bottom: 3px solid #667eea;
    }
    
    .auth-form {
      display: none;
    }
    
    .auth-form.active {
      display: block;
      animation: fadeIn 0.3s;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .form-control:focus {
      border-color: #667eea;
      box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
    }
    
    .alert {
      border-radius: 10px;
      border: none;
    }
    
    .user-dropdown {
      position: relative;
    }
    
    .user-menu {
      position: absolute;
      top: 100%;
      right: 0;
      background: white;
      border-radius: 10px;
      box-shadow: 0 5px 20px rgba(0,0,0,0.2);
      min-width: 200px;
      display: none;
      z-index: 1000;
      margin-top: 10px;
    }
    
    .user-menu.show {
      display: block;
      animation: fadeInDown 0.3s;
    }
    
    .user-menu-item {
      padding: 12px 20px;
      cursor: pointer;
      transition: all 0.3s;
      color: #333;
      border-bottom: 1px solid #f0f0f0;
    }
    
    .user-menu-item:hover {
      background: #f8f9fa;
      padding-left: 25px;
    }
    
    .user-menu-item:last-child {
      border-bottom: none;
    }
    
    .user-menu-item i {
      margin-right: 10px;
      width: 20px;
    }
  </style>
</head>
<body>

<nav class="navbar navbar-expand-lg navbar-dark bg-dark px-4">
  <a class="navbar-brand" href="#"><i class="fas fa-shopping-bag me-2"></i>MyShop</a>
  <div class="ms-auto d-flex gap-3 align-items-center">
    <!-- Guest View -->
    <div id="guest-view" class="d-flex gap-3 align-items-center">
      <span class="text-white d-none d-md-inline"><i class="fas fa-user me-2"></i>Welcome, Guest</span>
      <button class="btn btn-outline-light" onclick="showAuthModal()">Login / Sign Up</button>
    </div>
    
    <!-- User View -->
    <div id="user-view" class="d-flex gap-3 align-items-center" style="display: none !important;">
      <div class="user-dropdown">
        <button class="btn btn-outline-light" onclick="toggleUserMenu()">
          <i class="fas fa-user-circle me-2"></i><span id="user-name">User</span>
          <i class="fas fa-chevron-down ms-2"></i>
        </button>
        <div id="user-menu" class="user-menu">
          <div class="user-menu-item" onclick="viewProfile()">
            <i class="fas fa-user"></i>My Profile
          </div>
          <div class="user-menu-item" onclick="viewOrders()">
            <i class="fas fa-box"></i>My Orders
          </div>
          <div class="user-menu-item" onclick="handleLogout()">
            <i class="fas fa-sign-out-alt"></i>Logout
          </div>
        </div>
      </div>
    </div>
    
    <button class="btn btn-outline-light position-relative" data-bs-toggle="modal" data-bs-target="#cartModal">
      <i class="fas fa-shopping-cart me-2"></i>Cart 
      <span id="cart-count" class="badge bg-danger position-absolute top-0 start-100 translate-middle cart-badge">0</span>
    </button>
  </div>
</nav>

<div class="hero-section">
  <div class="container text-center">
    <h1><i class="fas fa-store me-3"></i>Welcome to MyShop</h1>
    <p class="lead">Discover amazing products at unbeatable prices!</p>
    
    <div class="search-bar">
      <input type="text" id="search-input" class="form-control" placeholder="Search for products...">
      <i class="fas fa-search"></i>
    </div>
    
    <div class="category-pills">
      <div class="category-pill active" data-category="all">All Products</div>
      <div class="category-pill" data-category="Electronics">Electronics</div>
      <div class="category-pill" data-category="Wearables">Wearables</div>
      <div class="category-pill" data-category="Audio">Audio</div>
    </div>
  </div>
</div>

<div class="container mb-5">
  <div class="filter-section">
    <div class="row align-items-center">
      <div class="col-md-4">
        <label class="form-label"><i class="fas fa-filter me-2"></i><strong>Sort By:</strong></label>
        <select id="sort-select" class="form-select">
          <option value="default">Default</option>
          <option value="price-low">Price: Low to High</option>
          <option value="price-high">Price: High to Low</option>
          <option value="rating">Highest Rated</option>
        </select>
      </div>
      <div class="col-md-4">
        <label class="form-label"><i class="fas fa-dollar-sign me-2"></i><strong>Max Price: $<span id="price-value">100</span></strong></label>
        <input type="range" id="price-range" class="form-range price-range" min="0" max="100" value="100">
      </div>
      <div class="col-md-4 text-end">
        <div class="mt-4">
          <strong id="product-count">0</strong> products found
        </div>
      </div>
    </div>
  </div>
  
  <div class="row g-4" id="product-list"></div>
  
  <div id="no-results" class="text-center py-5" style="display: none;">
    <i class="fas fa-search fa-4x text-muted mb-3"></i>
    <h3 class="text-muted">No products found</h3>
    <p class="text-muted">Try adjusting your filters or search terms</p>
  </div>
</div>

<div class="modal fade" id="productModal" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="modalTitle">Product Title</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body d-flex gap-4">
        <img id="modalImage" src="" class="img-fluid" style="max-width: 300px;" />
        <div>
          <h5 id="modalPrice"></h5>
          <p id="modalDescription"></p>
          <div id="modalRating"></div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="cartModal" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title"><i class="fas fa-shopping-cart me-2"></i>Your Shopping Cart</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <div id="empty-cart-message" class="empty-cart">
          <i class="fas fa-shopping-cart"></i>
          <h4>Your cart is empty</h4>
          <p>Start shopping to add items to your cart!</p>
        </div>
        <ul id="cart-items" class="list-group mb-3"></ul>
        <div id="cart-summary" style="display: none;">
          <hr>
          <div class="d-flex justify-content-between mb-2">
            <span>Subtotal:</span>
            <span id="cart-subtotal">$0.00</span>
          </div>
          <div class="d-flex justify-content-between mb-2">
            <span>Tax (10%):</span>
            <span id="cart-tax">$0.00</span>
          </div>
          <div class="d-flex justify-content-between mb-3">
            <h5>Total:</h5>
            <h5 id="cart-total">$0.00</h5>
          </div>
          <div class="text-center">
            <button class="checkout-btn w-100" onclick="checkout()">
              <i class="fas fa-credit-card me-2"></i>Proceed to Checkout
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Auth Modal -->
<div class="modal fade auth-modal" id="authModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title"><i class="fas fa-lock me-2"></i>Account Access</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <!-- Alert Messages -->
        <div id="auth-alert" class="alert" style="display: none;"></div>
        
        <!-- Tabs -->
        <div class="auth-tabs">
          <button class="auth-tab active" onclick="switchAuthTab('login')">Login</button>
          <button class="auth-tab" onclick="switchAuthTab('signup')">Sign Up</button>
        </div>
        
        <!-- Login Form -->
        <form id="login-form" class="auth-form active" onsubmit="handleLogin(event)">
          <div class="mb-3">
            <label class="form-label"><i class="fas fa-envelope me-2"></i>Email</label>
            <input type="email" class="form-control" id="login-email" placeholder="Enter your email" required>
          </div>
          <div class="mb-3">
            <label class="form-label"><i class="fas fa-lock me-2"></i>Password</label>
            <input type="password" class="form-control" id="login-password" placeholder="Enter your password" required>
          </div>
          <div class="mb-3 text-end">
            <a href="#" class="text-decoration-none" onclick="showForgotPassword(event)">Forgot Password?</a>
          </div>
          <button type="submit" class="btn btn-primary w-100" id="login-btn">
            <i class="fas fa-sign-in-alt me-2"></i>Login
          </button>
        </form>
        
        <!-- Sign Up Form -->
        <form id="signup-form" class="auth-form" onsubmit="handleSignup(event)">
          <div class="mb-3">
            <label class="form-label"><i class="fas fa-user me-2"></i>Full Name</label>
            <input type="text" class="form-control" id="signup-name" placeholder="Enter your full name" required>
          </div>
          <div class="mb-3">
            <label class="form-label"><i class="fas fa-envelope me-2"></i>Email</label>
            <input type="email" class="form-control" id="signup-email" placeholder="Enter your email" required>
          </div>
          <div class="mb-3">
            <label class="form-label"><i class="fas fa-lock me-2"></i>Password</label>
            <input type="password" class="form-control" id="signup-password" placeholder="Create a password (min 6 characters)" required minlength="6">
          </div>
          <div class="mb-3">
            <label class="form-label"><i class="fas fa-lock me-2"></i>Confirm Password</label>
            <input type="password" class="form-control" id="signup-confirm" placeholder="Confirm your password" required>
          </div>
          <button type="submit" class="btn btn-primary w-100" id="signup-btn">
            <i class="fas fa-user-plus me-2"></i>Create Account
          </button>
        </form>
        
        <!-- Forgot Password Form -->
        <form id="forgot-form" class="auth-form" onsubmit="handleForgotPassword(event)" style="display: none;">
          <div class="mb-3">
            <label class="form-label"><i class="fas fa-envelope me-2"></i>Email</label>
            <input type="email" class="form-control" id="forgot-email" placeholder="Enter your email" required>
          </div>
          <button type="submit" class="btn btn-primary w-100" id="forgot-btn">
            <i class="fas fa-paper-plane me-2"></i>Send Reset Link
          </button>
          <button type="button" class="btn btn-outline-secondary w-100 mt-2" onclick="backToLogin()">
            <i class="fas fa-arrow-left me-2"></i>Back to Login
          </button>
        </form>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<!-- Supabase JS Client - Load before config -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="supabase-config.js"></script>
<script>
  const products = [
    {
      name: "Wireless Headphones",
      price: 49.99,
      rating: 4,
      image: "download.jpeg",
      description: "High-quality wireless headphones with noise cancellation and premium sound quality.",
      category: "Audio",
      badge: "Popular"
    },
    {
      name: "Smart Watch",
      price: 79.99,
      rating: 5,
      image: "download sw.jpeg",
      description: "Track fitness, notifications, and health with this advanced smartwatch.",
      category: "Wearables",
      badge: "Best Seller"
    },
    {
      name: "Bluetooth Speaker",
      price: 29.99,
      rating: 3,
      image: "download sp.jpeg",
      description: "Portable Bluetooth speaker with powerful sound and long battery life.",
      category: "Audio",
      badge: "Sale"
    },
    {
      name: "Wireless Earbuds",
      price: 39.99,
      rating: 5,
      image: "download.jpeg",
      description: "Premium wireless earbuds with crystal clear audio and comfortable fit.",
      category: "Audio",
      badge: "New"
    },
    {
      name: "Fitness Tracker",
      price: 59.99,
      rating: 4,
      image: "download sw.jpeg",
      description: "Advanced fitness tracker with heart rate monitoring and GPS.",
      category: "Wearables",
      badge: "Popular"
    },
    {
      name: "Portable Charger",
      price: 24.99,
      rating: 4,
      image: "download sp.jpeg",
      description: "High-capacity portable charger for all your devices on the go.",
      category: "Electronics",
      badge: "Sale"
    }
  ];

  const productList = document.getElementById("product-list");
  const cartItemsContainer = document.getElementById("cart-items");
  const cartTotal = document.getElementById("cart-total");
  const searchInput = document.getElementById("search-input");
  const sortSelect = document.getElementById("sort-select");
  const priceRange = document.getElementById("price-range");
  const priceValue = document.getElementById("price-value");
  const productCount = document.getElementById("product-count");
  const noResults = document.getElementById("no-results");
  
  let cart = [];
  let currentCategory = "all";
  let currentSearch = "";
  let currentSort = "default";
  let maxPrice = 100;

  // Event Listeners
  searchInput.addEventListener("input", (e) => {
    currentSearch = e.target.value.toLowerCase();
    renderProducts();
  });

  sortSelect.addEventListener("change", (e) => {
    currentSort = e.target.value;
    renderProducts();
  });

  priceRange.addEventListener("input", (e) => {
    maxPrice = parseInt(e.target.value);
    priceValue.textContent = maxPrice;
    renderProducts();
  });

  document.querySelectorAll(".category-pill").forEach(pill => {
    pill.addEventListener("click", () => {
      document.querySelectorAll(".category-pill").forEach(p => p.classList.remove("active"));
      pill.classList.add("active");
      currentCategory = pill.dataset.category;
      renderProducts();
    });
  });

  function renderStars(rating) {
    return "★".repeat(rating) + "☆".repeat(5 - rating);
  }

  function showModal(product) {
    document.getElementById("modalTitle").innerText = product.name;
    document.getElementById("modalImage").src = product.image;
    document.getElementById("modalPrice").innerText = `$${product.price.toFixed(2)}`;
    document.getElementById("modalDescription").innerText = product.description;
    document.getElementById("modalRating").innerHTML = `<span class="star">${renderStars(product.rating)}</span>`;
    new bootstrap.Modal(document.getElementById('productModal')).show();
  }

  function addToCart(product) {
    const existing = cart.find(item => item.name === product.name);
    if (existing) {
      existing.quantity++;
    } else {
      cart.push({ ...product, quantity: 1 });
    }
    updateCartCount();
    updateCartView();
    
    // Show success feedback
    const btn = event.target;
    const originalText = btn.innerHTML;
    btn.innerHTML = '<i class="fas fa-check me-2"></i>Added!';
    btn.disabled = true;
    setTimeout(() => {
      btn.innerHTML = originalText;
      btn.disabled = false;
    }, 1000);
  }

  function removeFromCart(productName) {
    cart = cart.filter(item => item.name !== productName);
    updateCartCount();
    updateCartView();
  }

  function updateQuantity(productName, change) {
    const item = cart.find(item => item.name === productName);
    if (item) {
      item.quantity += change;
      if (item.quantity <= 0) {
        removeFromCart(productName);
      } else {
        updateCartView();
      }
    }
  }

  function updateCartCount() {
    const count = cart.reduce((sum, item) => sum + item.quantity, 0);
    document.getElementById("cart-count").innerText = count;
  }

  function updateCartView() {
    const emptyMessage = document.getElementById("empty-cart-message");
    const cartSummary = document.getElementById("cart-summary");
    
    if (cart.length === 0) {
      emptyMessage.style.display = "block";
      cartSummary.style.display = "none";
      cartItemsContainer.innerHTML = "";
      return;
    }
    
    emptyMessage.style.display = "none";
    cartSummary.style.display = "block";
    cartItemsContainer.innerHTML = "";
    
    let subtotal = 0;
    cart.forEach(item => {
      const li = document.createElement("li");
      li.className = "list-group-item cart-item";
      li.innerHTML = `
        <div class="d-flex justify-content-between align-items-center">
          <div class="d-flex align-items-center gap-3">
            <img src="${item.image}" alt="${item.name}" style="width: 60px; height: 60px; object-fit: cover; border-radius: 10px;">
            <div>
              <h6 class="mb-1">${item.name}</h6>
              <small class="text-muted">$${item.price.toFixed(2)} each</small>
            </div>
          </div>
          <div class="d-flex align-items-center gap-3">
            <div class="quantity-controls">
              <button class="quantity-btn" onclick="updateQuantity('${item.name}', -1)">
                <i class="fas fa-minus"></i>
              </button>
              <span class="fw-bold">${item.quantity}</span>
              <button class="quantity-btn" onclick="updateQuantity('${item.name}', 1)">
                <i class="fas fa-plus"></i>
              </button>
            </div>
            <div style="min-width: 80px; text-align: right;">
              <strong>$${(item.price * item.quantity).toFixed(2)}</strong>
            </div>
            <button class="remove-btn" onclick="removeFromCart('${item.name}')">
              <i class="fas fa-trash"></i>
            </button>
          </div>
        </div>
      `;
      cartItemsContainer.appendChild(li);
      subtotal += item.price * item.quantity;
    });
    
    const tax = subtotal * 0.1;
    const total = subtotal + tax;
    
    document.getElementById("cart-subtotal").innerText = `$${subtotal.toFixed(2)}`;
    document.getElementById("cart-tax").innerText = `$${tax.toFixed(2)}`;
    cartTotal.innerText = `$${total.toFixed(2)}`;
  }

  function checkout() {
    if (cart.length === 0) return;
    
    const total = cart.reduce((sum, item) => sum + item.price * item.quantity, 0) * 1.1;
    alert(`Thank you for your purchase!\n\nTotal Amount: $${total.toFixed(2)}\n\nYour order has been placed successfully!`);
    cart = [];
    updateCartCount();
    updateCartView();
    bootstrap.Modal.getInstance(document.getElementById('cartModal')).hide();
  }

  function filterProducts() {
    return products.filter(product => {
      const matchesCategory = currentCategory === "all" || product.category === currentCategory;
      const matchesSearch = product.name.toLowerCase().includes(currentSearch) || 
                           product.description.toLowerCase().includes(currentSearch);
      const matchesPrice = product.price <= maxPrice;
      return matchesCategory && matchesSearch && matchesPrice;
    });
  }

  function sortProducts(filteredProducts) {
    const sorted = [...filteredProducts];
    switch(currentSort) {
      case "price-low":
        return sorted.sort((a, b) => a.price - b.price);
      case "price-high":
        return sorted.sort((a, b) => b.price - a.price);
      case "rating":
        return sorted.sort((a, b) => b.rating - a.rating);
      default:
        return sorted;
    }
  }

  function renderProducts() {
    const filtered = filterProducts();
    const sorted = sortProducts(filtered);
    
    productList.innerHTML = "";
    productCount.textContent = sorted.length;
    
    if (sorted.length === 0) {
      noResults.style.display = "block";
      return;
    }
    
    noResults.style.display = "none";
    
    sorted.forEach((product, index) => {
      const col = document.createElement("div");
      col.className = "col-md-4 col-lg-4";
      col.innerHTML = `
        <div class="card h-100 position-relative">
          ${product.badge ? `<div class="product-badge">${product.badge}</div>` : ''}
          <img src="${product.image}" class="card-img-top" alt="${product.name}">
          <div class="card-body d-flex flex-column">
            <h5 class="card-title">${product.name}</h5>
            <p class="price-tag mb-2">$${product.price.toFixed(2)}</p>
            <div class="mb-3"><span class="star">${renderStars(product.rating)}</span></div>
            <p class="card-text text-muted small mb-3">${product.description.substring(0, 80)}...</p>
            <button class="btn btn-primary mt-auto mb-2" onclick='addToCart(${JSON.stringify(product)})'>
              <i class="fas fa-cart-plus me-2"></i>Add to Cart
            </button>
            <button class="btn btn-outline-secondary" onclick='showModal(${JSON.stringify(product)})'>
              <i class="fas fa-eye me-2"></i>View Details
            </button>
          </div>
        </div>
      `;
      productList.appendChild(col);
    });
  }

  // Initial render
  renderProducts();
  
  // Initialize authentication on page load
  // Wait for DOM to be fully loaded
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initAuth);
  } else {
    // DOM is already loaded
    initAuth();
  }
  
  // Newsletter subscription
  function subscribeNewsletter() {
    const emailInput = document.getElementById('newsletter-email');
    const email = emailInput.value.trim();
    
    if (email && email.includes('@')) {
      alert(`Thank you for subscribing!\n\nWe've added ${email} to our newsletter list.`);
      emailInput.value = '';
    } else {
      alert('Please enter a valid email address.');
    }
  }
  
  // ============================================
  // AUTHENTICATION FUNCTIONS
  // ============================================
  
  let currentUser = null;
  let authModal = null;
  
  // Initialize authentication
  async function initAuth() {
    try {
      // Check if auth object exists
      if (typeof auth === 'undefined') {
        console.error('Auth object not found. Make sure supabase-config.js is loaded.');
        return;
      }
      
      authModal = new bootstrap.Modal(document.getElementById('authModal'));
      
      // Check for existing session
      const session = await auth.getSession();
      if (session && session.user) {
        currentUser = session.user;
        updateUIForUser(currentUser);
      }
      
      // Listen for auth state changes
      auth.onAuthStateChange((event, session) => {
        if (event === 'SIGNED_IN' && session) {
          currentUser = session.user;
          updateUIForUser(currentUser);
        } else if (event === 'SIGNED_OUT') {
          currentUser = null;
          updateUIForGuest();
        }
      });
    } catch (error) {
      console.error('Error initializing auth:', error);
    }
  }
  
  // Show auth modal
  function showAuthModal() {
    authModal.show();
  }
  
  // Switch between login/signup tabs
  function switchAuthTab(tab) {
    // Update tabs
    document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
    event.target.classList.add('active');
    
    // Update forms
    document.querySelectorAll('.auth-form').forEach(f => f.classList.remove('active'));
    
    if (tab === 'login') {
      document.getElementById('login-form').classList.add('active');
    } else if (tab === 'signup') {
      document.getElementById('signup-form').classList.add('active');
    }
    
    // Clear alert
    hideAlert();
  }
  
  // Handle login
  async function handleLogin(event) {
    event.preventDefault();
    
    try {
      const email = document.getElementById('login-email').value;
      const password = document.getElementById('login-password').value;
      const btn = document.getElementById('login-btn');
      
      // Validate inputs
      if (!email || !password) {
        showAlert('danger', 'Please enter both email and password.');
        return;
      }
      
      // Disable button and show loading
      btn.disabled = true;
      btn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Logging in...';
      
      const result = await auth.signIn(email, password);
      
      if (result.success) {
        showAlert('success', 'Login successful! Welcome back.');
        setTimeout(() => {
          authModal.hide();
          document.getElementById('login-form').reset();
          hideAlert();
        }, 1000);
      } else {
        showAlert('danger', result.error || 'Login failed. Please check your credentials.');
      }
      
      // Re-enable button
      btn.disabled = false;
      btn.innerHTML = '<i class="fas fa-sign-in-alt me-2"></i>Login';
    } catch (error) {
      console.error('Login error:', error);
      showAlert('danger', 'An unexpected error occurred. Please try again.');
      document.getElementById('login-btn').disabled = false;
      document.getElementById('login-btn').innerHTML = '<i class="fas fa-sign-in-alt me-2"></i>Login';
    }
  }
  
  // Handle signup
  async function handleSignup(event) {
    event.preventDefault();
    
    try {
      const name = document.getElementById('signup-name').value;
      const email = document.getElementById('signup-email').value;
      const password = document.getElementById('signup-password').value;
      const confirm = document.getElementById('signup-confirm').value;
      const btn = document.getElementById('signup-btn');
      
      // Validate inputs
      if (!name || !email || !password || !confirm) {
        showAlert('danger', 'Please fill in all fields.');
        return;
      }
      
      // Validate passwords match
      if (password !== confirm) {
        showAlert('danger', 'Passwords do not match!');
        return;
      }
      
      // Validate password length
      if (password.length < 6) {
        showAlert('danger', 'Password must be at least 6 characters long.');
        return;
      }
      
      // Disable button and show loading
      btn.disabled = true;
      btn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Creating account...';
      
      const result = await auth.signUp(email, password, name);
      
      if (result.success) {
        showAlert('success', 'Account created! Please check your email to verify your account.');
        setTimeout(() => {
          switchAuthTab('login');
          document.getElementById('signup-form').reset();
          hideAlert();
        }, 2000);
      } else {
        showAlert('danger', result.error || 'Signup failed. Please try again.');
      }
      
      // Re-enable button
      btn.disabled = false;
      btn.innerHTML = '<i class="fas fa-user-plus me-2"></i>Create Account';
    } catch (error) {
      console.error('Signup error:', error);
      showAlert('danger', 'An unexpected error occurred. Please try again.');
      document.getElementById('signup-btn').disabled = false;
      document.getElementById('signup-btn').innerHTML = '<i class="fas fa-user-plus me-2"></i>Create Account';
    }
  }
  
  // Show forgot password form
  function showForgotPassword(event) {
    event.preventDefault();
    document.querySelectorAll('.auth-form').forEach(f => f.classList.remove('active'));
    document.getElementById('forgot-form').style.display = 'block';
    document.getElementById('forgot-form').classList.add('active');
    document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
  }
  
  // Back to login
  function backToLogin() {
    document.getElementById('forgot-form').style.display = 'none';
    document.getElementById('forgot-form').classList.remove('active');
    document.getElementById('login-form').classList.add('active');
    document.querySelectorAll('.auth-tab')[0].classList.add('active');
    hideAlert();
  }
  
  // Handle forgot password
  async function handleForgotPassword(event) {
    event.preventDefault();
    
    const email = document.getElementById('forgot-email').value;
    const btn = document.getElementById('forgot-btn');
    
    btn.disabled = true;
    btn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Sending...';
    
    const result = await auth.resetPassword(email);
    
    if (result.success) {
      showAlert('success', 'Password reset link sent! Check your email.');
      setTimeout(() => {
        backToLogin();
        document.getElementById('forgot-form').reset();
      }, 2000);
    } else {
      showAlert('danger', result.error || 'Failed to send reset link.');
    }
    
    btn.disabled = false;
    btn.innerHTML = '<i class="fas fa-paper-plane me-2"></i>Send Reset Link';
  }
  
  // Handle logout
  async function handleLogout() {
    const result = await auth.signOut();
    if (result.success) {
      alert('You have been logged out successfully.');
      closeUserMenu();
    }
  }
  
  // Update UI for authenticated user
  function updateUIForUser(user) {
    document.getElementById('guest-view').style.display = 'none';
    document.getElementById('user-view').style.display = 'flex';
    
    const userName = user.user_metadata?.full_name || user.email.split('@')[0];
    document.getElementById('user-name').textContent = userName;
  }
  
  // Update UI for guest
  function updateUIForGuest() {
    document.getElementById('guest-view').style.display = 'flex';
    document.getElementById('user-view').style.display = 'none';
  }
  
  // Toggle user menu
  function toggleUserMenu() {
    const menu = document.getElementById('user-menu');
    menu.classList.toggle('show');
  }
  
  // Close user menu
  function closeUserMenu() {
    document.getElementById('user-menu').classList.remove('show');
  }
  
  // Close menu when clicking outside
  document.addEventListener('click', (e) => {
    const userDropdown = document.querySelector('.user-dropdown');
    if (userDropdown && !userDropdown.contains(e.target)) {
      closeUserMenu();
    }
  });
  
  // View profile
  function viewProfile() {
    closeUserMenu();
    alert('Profile page - Coming soon!');
  }
  
  // View orders
  function viewOrders() {
    closeUserMenu();
    alert('Orders page - Coming soon!');
  }
  
  // Show alert message
  function showAlert(type, message) {
    const alert = document.getElementById('auth-alert');
    alert.className = `alert alert-${type}`;
    alert.textContent = message;
    alert.style.display = 'block';
  }
  
  // Hide alert message
  function hideAlert() {
    const alert = document.getElementById('auth-alert');
    alert.style.display = 'none';
  }
</script>

<!-- Footer -->
<footer class="footer">
  <div class="container">
    <div class="row g-4">
      <!-- About Section -->
      <div class="col-md-3">
        <h5><i class="fas fa-shopping-bag me-2"></i>MyShop</h5>
        <p class="text-white-50">Your one-stop destination for quality products at amazing prices. Shop with confidence and enjoy the best deals!</p>
        <div class="social-icons">
          <a href="#" class="social-icon" title="Facebook">
            <i class="fab fa-facebook-f"></i>
          </a>
          <a href="#" class="social-icon" title="Twitter">
            <i class="fab fa-twitter"></i>
          </a>
          <a href="#" class="social-icon" title="Instagram">
            <i class="fab fa-instagram"></i>
          </a>
          <a href="#" class="social-icon" title="LinkedIn">
            <i class="fab fa-linkedin-in"></i>
          </a>
        </div>
      </div>
      
      <!-- Help & Support Section -->
      <div class="col-md-3">
        <h5><i class="fas fa-question-circle me-2"></i>Help & Support</h5>
        <ul class="footer-links">
          <li><a href="#"><i class="fas fa-chevron-right"></i>FAQ</a></li>
          <li><a href="#"><i class="fas fa-chevron-right"></i>Shipping Information</a></li>
          <li><a href="#"><i class="fas fa-chevron-right"></i>Returns & Exchanges</a></li>
          <li><a href="#"><i class="fas fa-chevron-right"></i>Order Tracking</a></li>
          <li><a href="#"><i class="fas fa-chevron-right"></i>Size Guide</a></li>
          <li><a href="#"><i class="fas fa-chevron-right"></i>Payment Options</a></li>
        </ul>
      </div>
      
      <!-- Quick Links Section -->
      <div class="col-md-3">
        <h5><i class="fas fa-link me-2"></i>Quick Links</h5>
        <ul class="footer-links">
          <li><a href="#"><i class="fas fa-chevron-right"></i>About Us</a></li>
          <li><a href="#"><i class="fas fa-chevron-right"></i>Privacy Policy</a></li>
          <li><a href="#"><i class="fas fa-chevron-right"></i>Terms & Conditions</a></li>
          <li><a href="#"><i class="fas fa-chevron-right"></i>Careers</a></li>
          <li><a href="#"><i class="fas fa-chevron-right"></i>Blog</a></li>
          <li><a href="#"><i class="fas fa-chevron-right"></i>Affiliate Program</a></li>
        </ul>
      </div>
      
      <!-- Contact Section -->
      <div class="col-md-3">
        <h5><i class="fas fa-envelope me-2"></i>Contact Us</h5>
        <ul class="contact-info">
          <li>
            <i class="fas fa-map-marker-alt"></i>
            <span>123 Shopping Street, NY 10001</span>
          </li>
          <li>
            <i class="fas fa-phone"></i>
            <span>+1 (555) 123-4567</span>
          </li>
          <li>
            <i class="fas fa-envelope"></i>
            <span>support@myshop.com</span>
          </li>
          <li>
            <i class="fas fa-clock"></i>
            <span>Mon - Fri: 9AM - 6PM</span>
          </li>
        </ul>
        
        <!-- Newsletter -->
        <div class="mt-4">
          <h6><i class="fas fa-bell me-2"></i>Newsletter</h6>
          <p class="text-white-50 small">Subscribe for exclusive deals!</p>
          <div class="newsletter-form">
            <input type="email" id="newsletter-email" placeholder="Your email" />
            <button onclick="subscribeNewsletter()">
              <i class="fas fa-paper-plane"></i>
            </button>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Footer Bottom -->
    <div class="footer-bottom">
      <div class="row">
        <div class="col-md-6 text-md-start text-center mb-2">
          <p class="mb-0">&copy; 2025 MyShop. All rights reserved.</p>
        </div>
        <div class="col-md-6 text-md-end text-center">
          <p class="mb-0">
            <i class="fas fa-credit-card me-2"></i>
            <i class="fab fa-cc-visa me-2"></i>
            <i class="fab fa-cc-mastercard me-2"></i>
            <i class="fab fa-cc-paypal me-2"></i>
            <i class="fab fa-cc-amex"></i>
          </p>
        </div>
      </div>
    </div>
  </div>
</footer>

</body>
</html>
